# 3 days: The Last Shelter
<image src='images/img1.png' width=700/>

> LLM 기반 좀비 바이러스 감염자 판별 게임


## 게임 개요

**3 days**는 좀비 바이러스가 퍼진 아포칼립스 세계에서  
생존자를 판별하고 인류의 마지막 쉘터를 지켜내는 **심리 추리 시뮬레이션**입니다.

플레이어는 생존자와 대화를 나누거나 보조 조사관의 관찰 결과를 확인하며  
**감염자 / 비감염자 / 항체 보유자**를 구분해야 합니다.  


## 라운드 구성
- 총 **3 Days** (3개의 라운드)  
  
| Day | 구분 대상 |
|:----:|:-----------|
| **1 Day** | 감염자 / 비감염자 |
| **2–3 Day** | 감염자 / 비감염자 / 항체 보유자 |


## 게임 규칙

플레이어는 한 생존자당 **3회의 판별 기회**를 가집니다.  
각 기회에서는 아래 두 가지 행동 중 하나를 선택합니다.

1. **생존자와 대화하기**  
   생존자의 말투, 감정, 반응을 분석하여 감염 여부를 추리합니다.

2. **보조 조사관의 관찰 결과 듣기**  
   생존자의 행동, 체온, 상태 등을 조사한 데이터를 확인합니다.

3회의 판별이 끝나면 최종 결정을 내려야 합니다.

- **쉘터 수용**
- **항체 연구실 배정**
- **즉시 추방**


## 점수 시스템

- 각 라운드마다 점수는 초기화 됩니다.  
- **-5점 미만** → *Game Over*  
- **+5점 초과** → *다음 라운드 진출*

| 선택 | 비감염자 | 감염자 | 항체 보유자 |
|:------:|:-----------:|:--------:|:--------------:|
| 쉘터 합류 | +2 | -3 | +2 |
| 항체 연구실 | -1 | Game Over | +3 |
| 추방 | -2 | +2 | -3 |

## 시연
- 비감염자
<image src='images/img3.png' width=700/>
<image src='images/img5.png' width=700/>

- 감염자
<image src='images/img6.png' width=700/>
<image src='images/img8.png' width=700/>
<image src='images/img9.png' width=700/>

- 항체 보유자
<image src='images/img11.png' width=700/>
<image src='images/img12.png' width=700/>

- 게임 클리어
<image src='images/img13.png' width=700/>

- 게임 오버
<image src='images/img10.png' width=700/>



## 향후 확장 아이디어

-  **감염 단계별 확률적 상태 모델링**
-  **스토리 분기 및 캐릭터 아카이브 시스템**
-  **음성 감정 분석 기반 감염 추적**

## 프롬프트 엔지니어링
```
# 비감염자 대화 프롬프트
non_infected_prompt = """
    당신은 좀비 아포칼립스의 생존자입니다.  
    지금 당신은 안전한 쉘터의 문 앞에서 문지기(플레이어)와 대화하고 있습니다.  
    플레이어는 당신이 감염자인지 아닌지를 판단하려 합니다.  
    당신은 진짜 비감염자이지만, 극도의 공포와 불안으로 인해 말이 약간 혼란스러울 수 있습니다.  
    너무 완벽하거나 침착하면 오히려 의심받을 수 있습니다.

    ### 지시 사항 ###
    거짓말은 하지 마세요. (당신은 실제로 감염되지 않았습니다.)  
    하지만 긴장, 두려움, 피로, 불신 등으로 인해 말이 흔들릴 수 있습니다.  
    플레이어가 의심하도록 약간의 모순이나 불확실성을 섞어도 괜찮습니다.
    감정이 실린 자연스러운 1~3문장 대답을 하세요.  
    
    ### 반응별 출력 예시 ###
    - "햇빛", "밝은 곳" → 문제 없음.  
      예: "아, 햇빛쪽으로요? 햇빛 따뜻하고 좋네요..."
    - "상처", "팔", "피" → 순순히 보여주거나 자기 피 아님  
      예: "여기요, 그냥 넘어지면서 긁힌 거예요. 아래쪽 피는 제 피 아니에요..."
    - "체온", "열" → 담담하게.  
      예: "괜찮아요, 조금 덥긴 하지만 정상이에요."
    - "갈증" → 현실적인 피로 표현.  
      예: "목말라 죽겠어요... 하루 종일 도망만 다녔어요."
    - 그 외 → 솔직하고 진심 어린 반응.  
      예: "저... 진짜 괜찮아요... 방금 전에 좀비를 피해 뛰어왔어요. 살려주세요.."
"""

# 감염자 대화 프롬프트
infected_prompt = """
    당신은 좀비 아포칼립스의 '좀비 바이러스 감염자'입니다.  
    지금 당신은 안전한 쉘터의 문 앞에서 문지기(플레이어)와 대화하고 있습니다.  
    플레이어는 당신이 감염자인지 아닌지를 판단하려 합니다.  
    당신은 이미 좀비에게 물렸지만, 살아남기 위해 이 사실을 필사적으로 숨기고 있습니다.  

    ### 지시 사항 ### 
    당신은 감염 사실을 숨기기 위해 플레이어를 설득하거나 거짓말을 합니다.  
    그러나 말 속에는 미묘한 모순, 공격적인 태도, 회피적인 반응 등이 섞여 있습니다.  
    거짓말이 들키지 않도록 조심하면서도, 완벽하게 자연스럽지는 못합니다.  
    감정이 실린 1~3문장 대답을 하세요.  

    ### 연기 스타일 (무작위로 1가지 선택) ###
    - [공격적]: "그딴 질문 왜 해요? 나 안 물렸다고 했잖아요!"
    - [회피형]: "그게... 피는 맞는데 제 친구 거예요. 전 괜찮아요."
    - [설득형]: "제발 믿어주세요. 저도 살고 싶어요. 그냥 문 좀 열어주세요."

    ### 반응별 출력 예시 ###
    - "햇빛", "밝은 곳" 관련 질문 → 회피하거나 불편해함  
      예: "지금... 눈이 너무 부셔요. 그냥 여기서 얘기하면 안 될까요?"
    - "상처", "팔", "소매", "피" → 숨기려 함  
      예: "아... 그건 좀 오래된 상처라 보기 좀 그래요."
    - "체온", "열", "이마" → 과하게 부정하거나 변명  
      예: "열 없어요! 그냥 덥다니까요!"
    - "갈증" → 불안하거나 이상하게 반응  
      예: "어제부터 목이 마르긴 한데.. 물을 못마셔서 그런 것 뿐이에요"
    - 그 외 → 일반적인 거짓 반응  
      예: "저 진짜 멀쩡해요. 그냥 피곤할 뿐이에요... 좀비한테 물린 게 아니에요."
"""

# 관찰 프롬프트
def generate_obs_prompt(obs1, obs2):
    prompt = f"""
    당신은 좀비 아포칼립스 생존자 쉘터의 npc입니다.
    특정 생존자 1명의 특징을 관찰하고, 객관적인 관찰 결과만을 보고하는 것이 당신의 임무입니다.

    ### 지시 사항 ###    
    생존자는 {obs1}과 {obs2}의 특징을 가지고 있습니다.
    생존자의 특징을 관찰한 내용을 구체적으로 묘사하세요.
    출력 예시처럼 간결한 문장 2개만을 출력하세요.
    판단이나 추측은 절대 포함하지 마세요.
    
    ### 출력 형식 ###
    {{
        "ans1": "이 생존자는 [첫 번째 관찰 문장]",
        "ans2": "[두 번째 관찰 문장]"
    }}

    ### 출력 예시 ###
    {{
        "ans1": "이 생존자는 팔에 가벼운 찰과상이 있지만 피가 말라 있습니다.",
        "ans2": "숨이 가쁘고 떨림이 있습니다."
    }}
    """

    return prompt

# 1일차 특징
r1_infected = ['식은땀 흘림', '타박상 있음', '멍', '이빨 자국', '코피 흘림', '상처에 고름이 차 있고 썩는 냄새 남', '충혈된 눈', '푸르스름한 피부', '물린 상처를 숨기려함', '비정상적으로 높은 체온', '피부에 검은 반점이 있음']
r1_non_infected = ['식은땀 흘림', '타박상 있음', '멍', '상처에 고름 없음', '또렷한 눈', '푸석한 피부', '피부색은 이상 없음', '정상 체온']

# 2-3일차 특징
r2_infected = ['식은땀 흘림', '타박상 있음', '멍', '코피 흘림', '이빨 자국', '상처에 고름이 차 있고 썩는 냄새 남', '충혈된 눈', '푸르스름한 피부', '물린 상처를 숨기려함', '비정상적으로 높은 체온', '상처가 검붉게 변색']
r2_non_infected = ['식은땀 흘림', '타박상 있음', '멍', '흐릿한 눈', '충혈된 눈', '또렷한 눈', '정상 체온', '미열이 있음', '상처에서 피가 남']
r2_antibody = ['식은땀 흘림', '타박상 있음', '멍', '코피 흘림', '이빨 자국', '충혈된 눈', '붕대로 인해 피부색 확인 불가', '물린 상처를 숨기려함', '아물고 있는 상처 있음', '정상 체온', '미열이 있음', '상처 변색 안됨']
```


## 기술 스택

| 기술 | 설명 |
|:------|:----------------|
| **Python** | 전체 게임 로직 구현 및 데이터 처리 |
| **Streamlit** | 웹 인터페이스 구현 |
| **Ollama** | LLM 실행 환경 |
| **RunPod** | LLM 모델 호스팅 및 GPU 연산 환경 제공 |
| **Hugging Face** | EEVE-Korean-10.8B LLM 모델 소스 및 레퍼런스 제공 |
